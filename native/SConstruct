#!/usr/bin/env python
import os

# This SConstruct file builds a GDExtension module for Godot Engine
# This file has been generated by ChatGPT

# --------------------------------------------------------------
# Configuration section
# --------------------------------------------------------------

module_name = "life_particles"      
# Name of your extension. This will prefix the output DLL:
# → liblife_particles.windows.template_debug.x86_64.dll

godot_bin_path = "../godot/bin"      
# Path where the compiled library will be placed.
# Godot loads extensions directly from this folder.

godot_cpp_path = "godot-cpp"        
# Path to the godot-cpp bindings (already cloned + built).

src_path = "src"                    
# Folder containing your C++ source files.


# --------------------------------------------------------------
# Load the SConstruct provided by godot-cpp
# --------------------------------------------------------------

env = SConscript(os.path.join(godot_cpp_path, "SConstruct"))
# This imports the build environment configured by godot-cpp.
# It automatically provides all required compiler flags,
# include paths, defines, and linking rules for GDExtension.


# --------------------------------------------------------------
# Add include directories and collect source files
# --------------------------------------------------------------

env.Append(CPPPATH=[src_path])
# Add your "src/" folder to the list of include paths,
# so headers like #include "life_particles.h" can be found.

sources = Glob(f"{src_path}/*.cpp")
# Automatically collect all .cpp files in the src/ directory.
# → This avoids manually listing each file.


# --------------------------------------------------------------
# Configure the output library path and filename
# --------------------------------------------------------------

target = os.path.join(
    godot_bin_path,
    f"lib{module_name}{env['suffix']}{env['SHLIBSUFFIX']}"
)
# Build output file name, using:
# - env['suffix']      → ".windows.template_debug.x86_64"
# - env['SHLIBSUFFIX'] → ".dll"
#
# Final result example:
# ../godot/bin/liblife_particles.windows.template_debug.x86_64.dll


# --------------------------------------------------------------
# Build the shared library (DLL)
# --------------------------------------------------------------

library = env.SharedLibrary(
    target=target,
    source=sources
)
# Build the DLL from the collected sources.
# SharedLibrary() automatically links against the correct
# godot-cpp libraries (debug/release depending on the target).


# --------------------------------------------------------------
# Default build target
# --------------------------------------------------------------

Default(library)
# When running "scons", this tells SCons that the default action
# is to compile and output the extension library.
